@if (selectedPlaylist(); as playlist) {
<div class="panel-header">
  <div>
    <p class="eyebrow">Agregar canciones</p>
    <h2 class="panel-title">
      <iconify-icon icon="solar:music-note-2-line-duotone"></iconify-icon>
      <span>Buscar y añadir</span>
    </h2>
    <span>Lista activa: {{ playlist.listName }}</span>
  </div>
</div>

<div class="search-form playlist-search-form" [formGroup]="searchForm">
  <label for="playlistTrackQuery">Busca una canción para añadir</label>
  <div class="search-row playlist-search-row">
    <input
      id="playlistTrackQuery"
      class="playlist-search-input"
      type="text"
      formControlName="query"
      placeholder="Buscar canciones..."
    />
  </div>
</div>

@if (searchError()) {
<p class="search-error">{{ searchError() }}</p>
}

@if (searchResults().length > 0) {
<section class="results playlist-search-results">
  <h3 class="section-title">
    <iconify-icon icon="solar:minimalistic-magnifer-line-duotone"></iconify-icon>
    <span>Resultados</span>
  </h3>
  <div class="results-scroll">
    @for (track of searchResults(); track track.id) {
    <article class="result-item playlist-result-item">
      <img [src]="track.cover" alt="Cover de {{ track.title }}" />
      <div class="track-info">
        <strong>{{ track.title }}</strong>
        <span>{{ track.artist }}</span>
      </div>
      <button type="button" (click)="onTrackSelected(track)" [disabled]="isAdding(track.id)">
        {{ isAdding(track.id) ? 'Añadiendo...' : 'Agregar canción' }}
      </button>
    </article>
    }
  </div>
</section>
} @else if (!searchingTracks() && hasTypedQuery()) {
<p class="empty">No se encontraron resultados</p>
}
} @else {
<section class="state-card">
  <iconify-icon class="state-icon" icon="solar:music-library-2-line-duotone"></iconify-icon>
  <h2>Sin lista activa</h2>
  <p>Selecciona una lista para buscar canciones y agregarlas.</p>
</section>
}
