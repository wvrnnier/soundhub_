<div class="profile-page">

    <!-- MODO EDICIÓN: MODAL -->
    @if (isEditing) {
    <div class="modal-overlay" (click)="toggleEdit()">
        <div class="modal-content" (click)="$event.stopPropagation()">
            <button class="close-btn" (click)="toggleEdit()">&times;</button>
            <h2>Editar Perfil</h2>

            <form [formGroup]="profileForm" (ngSubmit)="saveProfile()" class="edit-form">

                <div class="form-group">
                    <label>Nombre de usuario</label>
                    <input type="text" formControlName="username" placeholder="Tu nombre">
                </div>

                <div class="form-group">
                    <label>Email</label>
                    <input type="email" formControlName="email" placeholder="correo@ejemplo.com">
                </div>

                <div class="form-checkbox">
                    <input type="checkbox" id="news" formControlName="newsletter">
                    <label for="news">Recibir novedades y ofertas</label>
                </div>

                <div class="form-group">
                    <label>Nueva contraseña <span class="optional-label">(opcional)</span></label>
                    <input type="password" formControlName="password" placeholder="Dejar vacío para no cambiar">
                    @if (profileForm.controls.password.touched && profileForm.controls.password.errors?.['minlength']) {
                    <span class="form-error">Mínimo 8 caracteres</span>
                    }
                </div>

                <div class="form-actions">
                    <button type="button" class="btn-cancel" (click)="toggleEdit()">Cancelar</button>
                    <button type="submit" class="btn-save" [disabled]="profileForm.invalid">Guardar cambios</button>
                </div>

            </form>
        </div>
    </div>
    }

    <div class="profile-header">
        <div class="profile-img-container">
            <img [src]="userView.image" alt="Profile" class="profile-img" />
            <div class="edit-overlay"></div>
        </div>

        <div class="profile-info">
            <h1 class="name">{{ userView.name }}</h1>
            <div class="stats">
                <span>{{ playlistCount() }} listas</span>
            </div>
        </div>

        <!-- Botón que activa la edición -->
        <button class="edit-btn" (click)="toggleEdit()">
            editar
        </button>
    </div>

    <div class="content">
        <section class="section">
            <div class="section-top">
                <h2>{{ sectionTitle() }}</h2>
            </div>
            <div class="track-grid">
                @for (track of displayTracks().slice(0, 14); track track.id) {
                <app-track-card [track]="track"></app-track-card>
                }
                @empty {
                <p class="empty-message">Aún no tienes canciones. ¡Crea una lista y añade temas!</p>
                }
            </div>
        </section>
    </div>

    <div class="danger-zone">
        <button type="button" class="btn-delete" (click)="deleteUser()">
            Eliminar cuenta
        </button>
    </div>

</div>

<!-- MODAL DE CONFIRMACIÓN DE BORRADO -->
@if (isDeleting) {
<div class="modal-overlay" (click)="cancelDelete()">
    <div class="modal-content" (click)="$event.stopPropagation()">
        <button class="close-btn" (click)="cancelDelete()">&times;</button>
        <h2>¿Eliminar cuenta?</h2>
        <p class="modal-message">Esta acción es irreversible. Perderás todos tus datos y listas de reproducción.</p>
        <div class="form-group">
            <input type="password" [formControl]="deletePasswordControl" placeholder="Contraseña para confirmar">
        </div>
        <div class="modal-actions">
            <button class="modal-cancel" (click)="cancelDelete()">Cancelar</button>
            <button class="modal-confirm" [disabled]="deletePasswordControl.invalid" (click)="confirmDelete()">
                Eliminar cuenta
            </button>
        </div>
    </div>
</div>
}